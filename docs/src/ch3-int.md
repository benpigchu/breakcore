# 第三章第二部分：抢占式调度的分时多任务系统

## 处理时钟中断

首先我们需要启用从 U 态到 S 态中断。为此，我们需要在应用程序的上下文中的 sstatus 中设置 spie bit，这样等进入用户态之后我们便可以收到中断了。同时，我们也设置 sie 中的 stip 开启时钟中断。之后，我们再根据 time 寄存器获得当前时间，再根据这个时间通过 SBI 调用设置时钟，这样我们便可以在 U 态时通过时钟中断切换到 S 态了。之后只需要在时钟中断处理中中切换上下文即可。

注意此时应用程序的输出十分混乱，这是因为用户程序并不会一次输出一整行的内容，而是分开输出各个部分。将来第四章引入动态内存分配之后我们就可以先拼好一行的字符串再输出了。

## 实现 get_time 和 sleep

我们只需要把 time 寄存器进行一些处理（除以一个每毫秒的 tick 数）再传回用户空间即可